# 配置数据库
## MySQL数据库安装与配置

1. 下载MySQL并进行安装
该步骤可以在网上搜索教程安装，安装的MySQL版本建议在5.7及以上

2. 创建数据库
登录MySQL命令行工具，执行以下命令创建数据库：
```shell
mysql -u root -p # 登录数据库
```
```SQL
CREATE DATABASE healthKiosk; // 创建数据库
EXIT; 
```
3. 导入数据库文件
```shell
mysql -u root -p healthKiosk < healthKiosk.sql
```

3. 推荐的MySQL可视化工具
我使用的是`HeidiSQL`，大家也可以使用`MySQL Workbench`等工具。
若使用`HeidiSQL`，网络类型选择`MariaDB(TCP/IP)`,依赖库选择`libmariadb.dll`，主机名填写`127.0.0.1`、用户名、密码按照个人信息填写。
## Redis数据库安装与配置

1. 下载Redis并进行安装
该步骤可以在网上搜索软件直接安装，安装方式比较简单。

# 安装Node版本管理器

1. 下载nvm进行node版本管理
该步骤可以在网上搜索教程安装

2. 安装Node
打开cmd：
```shell
nvm install <版本号>
nvm use <版本号>
```
我使用的是20.18.0进行开发的，若要使用不同版本，建议选择LTS版本

3. 检查是否安装成功
```shell
node -v
npm -v
```

# 安装项目依赖
## 后端操作
### 安装`node_modules`
进入后端目录安装依赖
```shell
cd health-kiosk-backend
npm install
```

### 配置环境变量
在`health-kiosk-backend`根目录下创建一个名为`.env`的文件，添加以下内容：
```ini
# MySQL settings
DB_HOST=127.0.0.1
DB_USER=root
DB_PASSWORD=root
DB_NAME=healthKiosk

# Redis default settings, using for store users' info
REDIS_HOST=127.0.0.1
REDIS_PORT=6379

# Use to send email
EMAIL_USER=<邮箱>
EMAIL_PASS=<邮箱授权码>

# Use JWT generate
JWT_SECRET=<随机字符串>

# openssl rand -base64 32
EMAIL_AES_KEY_BASE64=<随机字符串>
EMAIL_HMAC_KEY_BASE64=<随机字符串>
EMAIL_KEY_VERSION=v1
```

### 获取个人相关环境配置

1. 邮箱操作
用于发送验证码等功能，建议使用163邮箱，其他邮箱可能会有发送失败的情况。
进入163 邮箱 -> 设置 -> POP3/SMTP/IMAP -> 开启 SMTP -> 获取授权码 -> 填写在`.env`文件中`EMAIL_PASS`后。

2. `JWT_SECRET`
密钥生成方式如下，在终端中输入该命令，将获得的值填写到`JWT_SECRET`后。
```shell
openssl rand -hex 64
```
3. `EMAIL_AES_KEY_BASE64`和`EMAIL_HMAC_KEY_BASE64`
密钥生成方式如下，在终端中输入该命令，将获得的值填写到对应位置。两个值均采用该方式生成，但值不能使用同一个。
```shell
openssl rand -base64 32
```

## 前端操作
进入前端目录安装依赖
```
cd health-kiosk-frontend
npm install
```

# 配置Python环境

1. 下载并安装miniconda

2. 创建虚拟环境
```shell
conda create -n face_recognition python=3.9
conda activate face_recognition
```

3. 安装人脸识别相关依赖
```shell
pip install cmake
pip install face_recognition numpy mysql-connector-python python-dotenv opencv-python dlib
```

4. 配置环境变量
在`face_recognition`根目录下创建一个名为`.env`的文件，添加以下内容：
```ini
DB_HOST=localhost
DB_DATABASE=healthkiosk
DB_USER=root
DB_PASSWORD=root
DB_CHARSET=utf8mb4
```

# 运行项目
## 后端运行
进入后端目录，运行以下命令启动服务器：
```shell
cd health-kiosk-backend
conda activate face_recognition
node app.js
```
也可写成一个`.bat`文件便于进行启动
```shell
@echo off
cd /d C:\ <项目位置> \health-kiosk\health-kiosk-backend
call conda activate face_recognition
node app.js
```
## 前端运行
进入前端目录，运行以下命令启动前端项目：
```shell
cd health-kiosk-frontend
npm run dev
```
写成`.bat`文件的格式：
```shell
@echo off
cd /d C:\ <项目位置> \health-kiosk\health-kiosk-frontend
npm run dev
```

# Java相关说明
1. 在`QuickExam`这个Android项目中，由于存在大量串口设置，且系统存在为`arm`架构设计的库，不可能在电脑中直接运行，建议使用`Android Studio`进行打包，打包后将`.apk`文件传输到`Android`设备中进行运行。

2. 目前我确定的传输方式为蓝牙传输，但该方法传输速度缓慢，一次传输大概需要`20min`左右，若有更好的传输方式欢迎提出。

3. 在将`.apk`文件传输到`Android`设备后，安装时由于系统认为两个应用之间的项目识别号相同，会将其作为同一个应用的更新版本进行安装。但是由于每个人的设备不同，打包时签名文件也不同，系统无法进行更新，导致安装失败，所以建议在项目中更改应用的唯一识别号，之后再进行安装。另外也建议尽量使用一个人的电脑进行`.apk`的发布。
